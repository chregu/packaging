#!/usr/bin/php
<?php

define('CONFIGURE_PATH', dirname(__FILE__));

require_once(CONFIGURE_PATH . '/common.php');

$flags = array(
    'depends' => '-d',
    'postinst' => '--post-install',
    'preinst' => '--pre-install',
    'postrm' => '--post-uninstall',
    'prerm' => '--pre-uninstall',
    'exclude' => '--exclude', // rsync option
);

$configure = get_config('configure');
$filemapping = get_config('filemapping');

print 'Generating makefile... ';

$makefile = get_makefile_in();
$install_cmd = get_install_cmd();

$makefile = replace($makefile, 'INSTALLCMD', $install_cmd);
$makefile = template($makefile, $configure, $flags);

$fp = fopen(CONFIGURE_PATH . '/../Makefile', 'w');

if($fp === false) {
    die("Error: unable to open the file Makefile for writing.\n");
}

fputs($fp, $makefile);

print "done\n";
print "You can now use `make` to create your package.\n";
